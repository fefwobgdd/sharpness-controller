<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Image Sharpener</title>
  <style>
    html,body{margin:0;height:100%;font-family:Inter,system-ui;background:#0f0f16;color:#eee;display:flex;align-items:center;justify-content:center;padding:24px}
    .wrap{width:100%;max-width:1100px;background:#151521;border-radius:14px;box-shadow:0 0 40px rgba(0,0,0,0.6);padding:20px;display:grid;grid-template-columns:360px 1fr;gap:20px}
    @media(max-width:900px){.wrap{grid-template-columns:1fr}}
    .panel{background:#1c1c2b;border-radius:12px;padding:18px}
    h1{margin:0 0 12px 0;font-size:20px;font-weight:600}
    .controls{display:flex;flex-direction:column;gap:16px}
    input[type=file]{display:block}
    .btn{background:#4e7bff;padding:9px 14px;border-radius:8px;border:0;color:#fff;font-weight:600;cursor:pointer}
    .slider{display:flex;align-items:center;gap:10px}
    input[type=range]{flex:1}
    canvas{max-width:100%;height:auto;border-radius:8px;background:#000}
    .label{font-size:14px;color:#9da3ba;min-width:95px}
    .row{display:flex;gap:12px;width:100%}
    .col{flex:1}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <h1>Image Sharpener</h1>
      <div class="controls">
        <input id="file" type="file" accept="image/*">
        <div class="slider">
          <div class="label">Sharpness</div>
          <input id="amount" type="range" min="0" max="40000" value="80">
          <div id="amountVal">80%</div>
        </div>
        <button id="download" class="btn">Download PNG</button>
        <button id="reset" class="btn">Reset</button>
      </div>
    </div>
    <div class="panel">
      <div class="row">
        <div class="col">
          <div style="font-size:14px;margin-bottom:6px;color:#9da3ba">Original</div>
          <canvas id="orig"></canvas>
        </div>
        <div class="col">
          <div style="font-size:14px;margin-bottom:6px;color:#9da3ba">Sharpened</div>
          <canvas id="out"></canvas>
        </div>
      </div>
    </div>
  </div>

<script>
const fileEl = document.getElementById('file')
const origCanvas = document.getElementById('orig')
const outCanvas = document.getElementById('out')
const amountEl = document.getElementById('amount')
const amountVal = document.getElementById('amountVal')
const downloadBtn = document.getElementById('download')
const resetBtn = document.getElementById('reset')
let origCtx, outCtx, img = new Image()

function ensure(w,h){origCanvas.width=w;origCanvas.height=h;outCanvas.width=w;outCanvas.height=h;origCtx=origCanvas.getContext('2d');outCtx=outCanvas.getContext('2d')}
function clamp(v,min,max){return v<min?min:v>max?max:v}

function sharpen(amount){
  const w = origCanvas.width
  const h = origCanvas.height
  const src = origCtx.getImageData(0,0,w,h)
  const blurred = blur(src)
  const out = outCtx.createImageData(w,h)
  const t = w*h*4
  const k = amount/100
  for(let i=0;i<t;i+=4){
    out.data[i] = clamp(src.data[i] + k*(src.data[i]-blurred.data[i]),0,255)
    out.data[i+1] = clamp(src.data[i+1] + k*(src.data[i+1]-blurred.data[i+1]),0,255)
    out.data[i+2] = clamp(src.data[i+2] + k*(src.data[i+2]-blurred.data[i+2]),0,255)
    out.data[i+3] = src.data[i+3]
  }
  outCtx.putImageData(out,0,0)
}

function blur(imgData){
  const w = imgData.width
  const h = imgData.height
  const src = imgData.data
  const dst = new Uint8ClampedArray(src.length)
  const kernel = [1,2,1]
  const kw = 1
  const norm = 4

  const temp = new Uint8ClampedArray(src.length)
  for(let y=0;y<h;y++){
    for(let x=0;x<w;x++){
      let r=0,g=0,b=0,a=0
      for(let k=-kw;k<=kw;k++){
        const ix = clamp(x+k,0,w-1)
        const idx = (y*w+ix)*4
        const kv = kernel[k+kw]
        r+=src[idx]*kv
        g+=src[idx+1]*kv
        b+=src[idx+2]*kv
        a+=src[idx+3]*kv
      }
      const o = (y*w+x)*4
      temp[o]=r/norm
      temp[o+1]=g/norm
      temp[o+2]=b/norm
      temp[o+3]=a/norm
    }
  }

  for(let x=0;x<w;x++){
    for(let y=0;y<h;y++){
      let r=0,g=0,b=0,a=0
      for(let k=-kw;k<=kw;k++){
        const iy = clamp(y+k,0,h-1)
        const idx = (iy*w+x)*4
        const kv = kernel[k+kw]
        r+=temp[idx]*kv
        g+=temp[idx+1]*kv
        b+=temp[idx+2]*kv
        a+=temp[idx+3]*kv
      }
      const o = (y*w+x)*4
      dst[o]=r/norm
      dst[o+1]=g/norm
      dst[o+2]=b/norm
      dst[o+3]=a/norm
    }
  }
  return new ImageData(dst,w,h)
}

amountEl.addEventListener('input',()=>{
  amountVal.textContent = amountEl.value+'%'
  if(origCtx) sharpen(Number(amountEl.value))
})

fileEl.addEventListener('change',e=>{
  const f = e.target.files[0]
  if(!f) return
  const url = URL.createObjectURL(f)
  img = new Image()
  img.onload = ()=>{
    ensure(img.width,img.height)
    origCtx.drawImage(img,0,0)
    sharpen(Number(amountEl.value))
    URL.revokeObjectURL(url)
  }
  img.src = url
})

downloadBtn.addEventListener('click',()=>{
  const a = document.createElement('a')
  a.download = 'sharpened.png'
  a.href = outCanvas.toDataURL('image/png')
  a.click()
})

resetBtn.addEventListener('click',()=>{
  fileEl.value = ''
  origCtx.clearRect(0,0,origCanvas.width,origCanvas.height)
  outCtx.clearRect(0,0,outCanvas.width,outCanvas.height)
})
</script>

</body>
</html>
